@using HomeAssistant.Core.Models
@using HomeAssistant.Core.Models.ShoppingList
@model ShoppingListViewModel


<link rel="stylesheet" href="~/css/shoplist.css" asp-append-version="true" />





<div class="main-container">
	@if (Model.OutOfStockProducts.Any())
	{
		<div class="recommended">

			<div>
				<h2>Products Out Of Stock</h2>
				@foreach (var prod in Model.OutOfStockProducts)
				{
					<a class="btn product" onclick="OpenModal(this)" id="@prod.Id">
						<p>@prod.Name <span>-@prod.ProductCategory.Name</span></p>
						<p>Last added: @prod.AddedOn</p>
					</a>
				}
			</div>
		</div>
	}
	<div class="center">
		<h1>Choose Products to buy</h1>
		<div class="input-form">
			<div class="form-outline" data-mdb-input-init>
				<input onkeyup="onInput(this)" type="search" id="form1" class="form-control" placeholder="Search for products" aria-label="Search" />
			</div>
			<table class="table table-striped table-hover table-info">
				<tbody class="search-results">
				</tbody>
			</table>
		</div>
		<table class="table">
			<thead>
				<tr>
					<th scope="col">#</th>
					<th scope="col">Product Name</th>
					<th scope="col">Category</th>
					<th scope="col">Quantity</th>
					<th scope="col">Price</th>
					<th scope="col"></th>
				</tr>
			</thead>
			<tbody class="added-products">
				@{
					int count = 1;
					foreach (var prod in Model.Products)
					{
						<tr id="@prod.Id">
							<th scope="row">@(count++)</th>
							<td>@prod.Name</td>
							<td>@prod.CategoryName</td>
							<td>@prod.QuantityToBuy</td>
							<td>@($"{prod.Price:f2} lv")</td>
							<td>
								<form method="post">
									<button class="btn btn-danger" asp-controller="ShoppingList" asp-action="Delete" asp-route-prodId="@prod.Id">
										Delete
									</button>
								</form>
							</td>
						</tr>
					}
				}
			</tbody>
		</table>
		<form method="post">
			<button type="submit" class="btn btn-info" asp-controller="ShoppingList" asp-action="StartShopping">Start Shopping</button>
		</form>
	</div>
</div>


<div class="modal fade" id="addExistingProductModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="staticBackdropLabel">Add Product to Shopping List</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<form method="post" asp-controller="ShoppingList" asp-action="Product">
				<div class="modal-body">
					<input class="form-control" type="hidden" name="Id" id="productId" />
					<label for="productName">Product Name</label>
					<input class="form-control" disabled type="text" name="Name" id="productName" />
					<div class="modal-input">
						<div>
							<label for="quantity">Number of products</label>
							<input class="form-control" type="number" name="QuantityToBuy" id="quantity" placeholder="Quantity" min="1" step="1" required value="1" autocomplete="off" />
						</div>
						<div>
							<label for="price">Price</label>
							<input class="form-control" type="number" name="Price" id="price" placeholder="Price" min="0" step="any" value="0" autocomplete="off" />
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="submit" class="btn btn-primary">Add Product</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" id="addNonExistentProductModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="staticBackdropLabel">Add Product to Shopping List</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<form method="post" asp-controller="ShoppingList" asp-action="NewProduct">
				<div class="modal-body">
					<input class="form-control" type="hidden" name="Id" id="productId" value="-1" />
					<label for="productName">Product Name</label>
					<input class="form-control" type="text" name="Name" id="productNametoAdd" />
					<select name="CategoryName" class="form-control" aria-required="true">
						@foreach (var category in Model.AllCategories)
						{
							<option value="@category.Name">@category.Name</option>
						}
					</select>
					<div class="modal-input">
						<div>
							<label for="quantity">Number of products to buy</label>
							<input class="form-control" type="number" name="QuantityToBuy" id="quantity" placeholder="Quantity" min="1" step="1" required value="1" autocomplete="off" />
						</div>
						<div>
							<label for="price">Price</label>
							<input class="form-control" type="number" name="Price" id="price" placeholder="Price" min="0" step="any" value="0" autocomplete="off" />
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="submit" class="btn btn-primary">Add Product</button>
				</div>
			</form>
		</div>
	</div>
</div>




@section Scripts {
	<script src="~/js/shoppingListSearch.js"></script>
	<partial name="_ValidationScriptsPartial" />
}

